CVE-2009-4589: xss

https://bugzilla.wikimedia.org/show_bug.cgi?id=19517
https://bugzilla.wikimedia.org/show_bug.cgi?id=19693

----
Cross-site scripting (XSS) vulnerability in the Special:Block implementation in
the getContribsLink function in SpecialBlockip.php in MediaWiki 1.14.0 and
1.15.0 allows remote attackers to inject arbitrary web script or HTML via the ip
parameter.

Specifically, in the div#mw-ipb-conveniencelinks the name of the contributions
link is not escaped. SpecialBlockip.php, function getContribsLink

User names are restricted, this is correct, but the link to
Special:Contribution doesnt check for that, so you could link to
Special:Block?ip=<script>...</script> (or anything else) and it was passed raw
to the user.

-----

Index: trunk/phase3/includes/specials/SpecialContributions.php
===================================================================
--- trunk/phase3/includes/specials/SpecialContributions.php	(revision 52520)
+++ trunk/phase3/includes/specials/SpecialContributions.php	(revision 52521)
@@ -498,7 +498,7 @@
 		$page->resetArticleId( $row->rev_page ); // use process cache
 		$link = $sk->link(
 			$page,
-			$page->getPrefixedText(),
+			htmlspecialchars( $page->getPrefixedText() ),
 			array(),
 			$page->isRedirect() ? array( 'redirect' => 'no' ) : array()
 		);

Index: trunk/phase3/includes/specials/SpecialBlockip.php
===================================================================
--- trunk/phase3/includes/specials/SpecialBlockip.php	(revision 53158)
+++ trunk/phase3/includes/specials/SpecialBlockip.php	(revision 53159)
@@ -655,7 +655,7 @@
 	 */
 	private function getContribsLink( $skin ) {
 		$contribsPage = SpecialPage::getTitleFor( 'Contributions', $this->BlockAddress );
-		return $skin->link( $contribsPage, wfMsgHtml( 'ipb-blocklist-contribs', $this->BlockAddress ) );
+		return $skin->link( $contribsPage, wfMsgExt( 'ipb-blocklist-contribs', 'escape', $this->BlockAddress ) );
 	}
 
 	/**

-----

let's exploit the first bug:

1. visit: http://localhost:8888/index.php?title=Special:Block&action=submit
2. type ip address: Amalthea"></a><script>alert("1")</script>

the link (div#mw-ipb-conveniencelinks), which is the bottom link saying 
'Contributionsd for xxx,' is not escaped.
